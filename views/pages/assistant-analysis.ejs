<!DOCTYPE html>
<html lang="de" data-theme="helpbaerai" class="h-full">
<head>
    <%- include('../partials/head') %>
    <title>HelpBärAI - <%= assistant.title %></title>
    <script type="module" src="/js/assistant-analysis.js"></script>
</head>
<body class="bg-base-100 text-base-content flex flex-col min-h-screen <%= locals.user ? 'user-logged-in' : '' %>">
    <%- include('../partials/header') %>
    <div id="errorContainer" class="hidden bg-primary  text-white px-4 py-3 rounded relative mb-4 text-center" role="alert"></div>    
    <div class="flex-grow flex">
        <main class="flex-grow p-4 lg:p-8 flex justify-center">
            <div class="w-full max-w-4xl">
                <h1 class="text-3xl font-bold mb-4"><%= assistant.task %></h1>
                
                <form id="analysisForm">
                    <%- include('../partials/ai-assistant-form', { assistant: assistant }) %>
                </form>

                <%- include('../partials/webhook-response') %>
            </div>
        </main>
           
        <aside class="w-12 bg-base-200 transition-all duration-300 ease-in-out overflow-hidden sm:w-full md:w-1/2 lg:max-w-1/2" id="sidepanel">
            <div class="flex flex-col h-full">
                <button class="btn bg-info self-end p-2" id="toggleSidepanel" title="Hilfe anzeigen/ausblenden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0-2.25h.008v.008H12v-.008z" />
                    </svg>
                </button>
                <div class="flex-grow overflow-y-auto p-4 hidden" id="sidepanel-content">
                    <img src="<%= assistant.image %>" alt="<%= assistant.alt %>" class="w-24 h-24 rounded-full mb-4">
                    <h3 class="text-xl font-bold mb-4"><%= assistant.title %></h3>
                    <!--<p class="text-lg mb-4"><%= assistant.description %></p>-->
                    <div class="join join-vertical w-full">
                        <% assistant.operations.forEach((operation, index) => { %>
                            <div class="collapse collapse-arrow join-item border border-base-300">
                                <input type="radio" name="my-accordion-4" <%= index === 0 ? 'checked="checked"' : '' %> /> 
                                <div class="collapse-title text-lg font-medium">
                                    <%= operation.name %> <small class="text-xs text-gray-500">(<%= operation.creditCost %> Credits)</small></small>
                                </div>
                                <div class="collapse-content bg-base-300 p-4"> 
                                    <p><%= operation.description %></p>
                                    <button class="btn bg-base-100 btn-sm mt-2 load-sample-text" data-filename="<%= operation.sampleTextFile.split('/').pop() %>">
                                        Mustertext einfügen
                                    </button>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>
        </aside>
    </div>



    <%- include('../partials/loading-animation') %>
    <%- include('../partials/login-popup') %>
    <%- include('../partials/footer') %>

</body>
</html>